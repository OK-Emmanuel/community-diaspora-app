{
  "info": {
    "_postman_id": "diaspora-community-app-api",
    "name": "Diaspora Community App API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Postman collection for Diaspora Community App backend (Supabase REST API). Set your environment variables for SUPABASE_URL and SUPABASE_ANON_KEY. IMPORTANT: Always include both apikey and Authorization headers in your requests to avoid 401 errors."
  },
  "item": [
    {
      "name": "Auth - Sign Up",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/auth/v1/signup",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["auth", "v1", "signup"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{EMAIL}}\",\n  \"password\": \"{{PASSWORD}}\"\n}"
        }
      }
    },
    {
      "name": "Auth - Sign In",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/auth/v1/token?grant_type=password",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["auth", "v1", "token"],
          "query": [
            { "key": "grant_type", "value": "password" }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{EMAIL}}\",\n  \"password\": \"{{PASSWORD}}\"\n}"
        }
      }
    },
    {
      "name": "Members - Get Profile",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/members?id=eq.{{USER_ID}}",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "members"],
          "query": [
            { "key": "id", "value": "eq.{{USER_ID}}" }
          ]
        }
      }
    },
    {
      "name": "Members - Update Profile",
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/members?id=eq.{{USER_ID}}",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "members"],
          "query": [
            { "key": "id", "value": "eq.{{USER_ID}}" }
          ]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"first_name\": \"NewName\"\n}"
        }
      }
    },
    {
      "name": "Posts - List Posts",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/posts?select=*",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "posts"],
          "query": [
            { "key": "select", "value": "*" }
          ]
        }
      }
    },
    {
      "name": "Posts - List Posts with Author Info",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/posts?select=*,author:members(id,first_name,last_name,profile_image_url)&order=created_at.desc&limit=5",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "posts"],
          "query": [
            { "key": "select", "value": "*,author:members(id,first_name,last_name,profile_image_url)" },
            { "key": "order", "value": "created_at.desc" },
            { "key": "limit", "value": "5" }
          ]
        }
      }
    },
    {
      "name": "Posts - Create Post",
      "request": {
        "method": "POST",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/posts",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "posts"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"author_id\": \"{{USER_ID}}\",\n  \"title\": \"Test Post\",\n  \"content\": \"This is a test post.\"\n}"
        }
      }
    },
    {
      "name": "Posts - Get Single Post with Author",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/posts?id=eq.{{POST_ID}}&select=*,author:members(id,first_name,last_name,profile_image_url)",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "posts"],
          "query": [
            { "key": "id", "value": "eq.{{POST_ID}}" },
            { "key": "select", "value": "*,author:members(id,first_name,last_name,profile_image_url)" }
          ]
        }
      }
    },
    {
      "name": "Comments - List Comments for Post",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/comments?post_id=eq.{{POST_ID}}",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "comments"],
          "query": [
            { "key": "post_id", "value": "eq.{{POST_ID}}" }
          ]
        }
      }
    },
    {
      "name": "Comments - List Comments with Author Info",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/comments?post_id=eq.{{POST_ID}}&select=*,author:members(id,first_name,last_name,profile_image_url)&order=created_at.asc",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "comments"],
          "query": [
            { "key": "post_id", "value": "eq.{{POST_ID}}" },
            { "key": "select", "value": "*,author:members(id,first_name,last_name,profile_image_url)" },
            { "key": "order", "value": "created_at.asc" }
          ]
        }
      }
    },
    {
      "name": "Comments - Add Comment",
      "request": {
        "method": "POST",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/comments",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "comments"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"post_id\": \"{{POST_ID}}\",\n  \"author_id\": \"{{USER_ID}}\",\n  \"content\": \"This is a comment.\"\n}"
        }
      }
    },
    {
      "name": "Announcements - List Announcements",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/announcements?select=*",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "announcements"],
          "query": [
            { "key": "select", "value": "*" }
          ]
        }
      }
    },
    {
      "name": "Announcements - List with Author Info",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/announcements?select=*,author:members(id,first_name,last_name,profile_image_url)&order=created_at.desc",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "announcements"],
          "query": [
            { "key": "select", "value": "*,author:members(id,first_name,last_name,profile_image_url)" },
            { "key": "order", "value": "created_at.desc" }
          ]
        }
      }
    },
    {
      "name": "Announcements - Create Announcement",
      "request": {
        "method": "POST",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/announcements",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "announcements"]
        },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"author_id\": \"{{USER_ID}}\",\n  \"title\": \"Announcement Title\",\n  \"content\": \"Announcement body.\",\n  \"type\": \"general\"\n}"
        }
      }
    },
    {
      "name": "Events - List Events",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/events?select=*",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "events"],
          "query": [
            { "key": "select", "value": "*" }
          ]
        }
      }
    },
    {
      "name": "Contributions - List My Contributions",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/contributions?member_id=eq.{{USER_ID}}",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "contributions"],
          "query": [
            { "key": "member_id", "value": "eq.{{USER_ID}}" }
          ]
        }
      }
    },
    {
      "name": "Admin - List All Members",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "{{SUPABASE_URL}}/rest/v1/members?select=*,non_financial_members(*)",
          "host": ["{{SUPABASE_URL}}"],
          "path": ["rest", "v1", "members"],
          "query": [
            { "key": "select", "value": "*,non_financial_members(*)" }
          ]
        }
      }
    },
    {
      "name": "Debug - Check Cookies",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "http://localhost:3000/api/debug-cookies",
          "host": ["localhost"],
          "port": "3000",
          "path": ["api", "debug-cookies"]
        }
      }
    },
    {
      "name": "Debug - Get Member via API",
      "request": {
        "method": "GET",
        "header": [
          { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
          { "key": "Authorization", "value": "Bearer {{JWT}}" }
        ],
        "url": {
          "raw": "http://localhost:3000/api/member",
          "host": ["localhost"],
          "port": "3000",
          "path": ["api", "member"]
        }
      }
    },
    {
      "name": "Community",
      "item": [
        {
          "name": "Create Community",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Community Name\",\n  \"logo_url\": \"https://example.com/logo.png\",\n  \"favicon_url\": \"https://example.com/favicon.ico\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "List Communities",
          "request": {
            "method": "GET",
            "header": [
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community"]
            }
          },
          "response": []
        },
        {
          "name": "Get Community",
          "request": {
            "method": "GET",
            "header": [
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community?id=eq.{{COMMUNITY_ID}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community"],
              "query": [
                { "key": "id", "value": "eq.{{COMMUNITY_ID}}" }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Update Community",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community?id=eq.{{COMMUNITY_ID}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community"],
              "query": [
                { "key": "id", "value": "eq.{{COMMUNITY_ID}}" }
              ]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"New Name\",\n  \"logo_url\": \"https://example.com/newlogo.png\",\n  \"favicon_url\": \"https://example.com/newfavicon.ico\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Delete Community",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community?id=eq.{{COMMUNITY_ID}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community"],
              "query": [
                { "key": "id", "value": "eq.{{COMMUNITY_ID}}" }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Community Invite",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community_invites",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community_invites"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"community_id\": \"{{COMMUNITY_ID}}\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Validate Community Invite",
          "request": {
            "method": "GET",
            "header": [
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community_invites?invite_token=eq.{{INVITE_TOKEN}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community_invites"],
              "query": [
                { "key": "invite_token", "value": "eq.{{INVITE_TOKEN}}" }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Accept Community Invite",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "apikey", "value": "{{SUPABASE_ANON_KEY}}" },
              { "key": "Authorization", "value": "Bearer {{JWT}}" }
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/community_invites/accept",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "community_invites", "accept"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"invite_token\": \"{{INVITE_TOKEN}}\"\n}"
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    { "key": "SUPABASE_URL", "value": "https://zsmappumrdykdvnbvpix.supabase.co" },
    { "key": "SUPABASE_ANON_KEY", "value": "<your-anon-key>" },
    { "key": "EMAIL", "value": "" },
    { "key": "PASSWORD", "value": "" },
    { "key": "USER_ID", "value": "" },
    { "key": "JWT", "value": "" },
    { "key": "POST_ID", "value": "" },
    { "key": "COMMUNITY_ID", "value": "" },
    { "key": "INVITE_TOKEN", "value": "" }
  ]
} 